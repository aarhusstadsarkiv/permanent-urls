# permanent-urls

This repository contains and generates permanent URLs for the Aarhus City Archives.

Usage could be QR codes. The QR code could be printed on a physical object, e.g. a bridge, a building, a statue, a sign, etc. The QR code could be scanned by a mobile device, which would take the user to the permanent URL - and then this URL would redirect the user to the real URL. This way, the real URL could be changed without having to change the QR code.

    QR code -> permanent URL -> real URL

## Installation

    git clone git@github.com:aarhusstadsarkiv/permanent-urls.git
    uv venv
    source .venv/bin/activate
    uv sync

## URL generation and update

The redirect URLs should be placed in the [data/redirects.csv](data/redirects.csv) file.

The `File` column is the filename of the permanent URL. The `URL` column is the URL where the client will be redirected.

You may add a new permanent URL by adding a new line to this CSV file including the `URL` column. Then run the following command to generate the new redirect file(s) and update the `redirects.csv` file with the new `File` name(s).

    ./scripts/update_purls.py

Now you can `commit` and `push` the changes with the new and updated files.

Your new permanent URLs will be available at an address like the following:

    https://purl.aarhusstadsarkiv.dk/<file-name>

`<file-name>` is auto-generated by the `update_purls.py` script. It is a random string of 7 characters (letters and numbers) followed by `.html`.

E.g.:

https://purl.aarhusstadsarkiv.dk/0taceun.html

In order to generate a QR for a permanent URL, you may use a service like [qr.io](https://qr.io/)

## Import from CSV

If you need to add multiple `URLs` you may use a `csv` file (e.g. when importing from external sources like excel).
The following command will add `URLs` based on the column with index 2 (0 index based counting) of e.g. the `data/import.csv` file. 

    ./scripts/import_from_csv.py data/import.csv 2

Then run the following command to generate the new redirect file(s) and update the `data/redirects.csv` file with the new `File` name(s).

    ./scripts/update_purls.py

## Check URLs

    cp scripts/settings_dist.py scripts/settings.py

Edit the `MATTERMOST_WEBHOOK_URL` in `scripts/settings.py` to your own Mattermost webhook URL.
Then check all URLs by using the following command.

    ./scripts/check_urls.py

Or in a cron job (which in this case will run every  hour at minute 0):

    0 * * * * cd /home/appuser/permanent-urls && .venv/bin/python ./scripts/check_urls.py

The `cronjob` is running on the `service` server of Aarhus City Archives.
Connect to the `service` server:

    su appuser
    cd ~/